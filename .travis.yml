language: node_js
node_js:
- '8'
sudo: required
services:
- docker
branches:
  only:
  - master
env:
  global:
  - secure: yJb41HAOx+Nt19XmEghcrwWoC0fLF/DJ5MlD1RsRaFWcZlyvjT4Qm9iop8soqPXavlkOr40pk1CJck8zzwx3/wh8OBhrPsgI2OHvgWN8tkqcmDm7k/q9yxrsKyEYxYyIqVSU8DgcPc9XzTPwR0sJjHe50Smgmcvi3zCAr3Ae+plzSuW0z6evH9wETC+u47dmJhLi5zN1VR1CZn6h418xRcns5r+3Qo6bpq2jzyjApG4QSm8CVbrzZHkZKo+QLv6z7vgmJlDc8Hj9mtgGoybJuQ7z4prRWPYDvs0Gaov5CP/NqE9ZicNqa2Oo4v5RPwIL8YOeksDaMJDBz8h5XrlIyhqIp7Gn5IlcRvkPr7pTMBNiZoQI/bahaSSms61gvz1Mqc103wEMgUifhTDAHhgNsHKM2DfqBlAE5AkDimP47dJhGhyDW3h+/ApMYTR4bIQrH91X3Tzsdsz8KSA/vBrdlvYejPQ0cOy3x6NMOsaqJ+EDw9RUE+xoA31WzJe7DxFDFFMJqi0yA3sGG1kjDUNXcJkj9IL3ijjMHNgBMQQg3S1Vk0bZVj7V/ry0wEXoWLfY5OIkp2i45rK2Nbym9IqmBAB2ZS8IU2j8QH0W8/rUfebTnDbfrzIlNzl3ikjBzeDFCo7Hp1bhKiRXJ74LZXtcE87BZvvVWnSCmNET7fNtI2Y=
  - secure: aczIlkQYDu4Na0e85bi9XoqOZjGdXrIL+KZlMM5YqlNEfFzuFam25UYT2ENWkWejvVYzjoSvQ13fhbSSimpDA5nvWn5Taeu/PHlmOV/UsAdvdyQkqijSMwxvUDOfd5YjQFzdDNMzcrSUG+kje8q7DcF52rX8c715VQ+rY4AWkPHtJhHFaTGoNUAE44x62jcitLHxh6NdVXMUlMqS/Hf9VOmzM0Vxy70bIS11a886roca5lpZattq9p/9jRmL3VcP4u8RuVxRqsAgC0MGm7f4ekHsKfxj5BzIdjG12xmPVbnjtubLIT2A3L2qkDhRDpkg3tbdvr6Bjtsatyvn9VKgyInKN7uZ7XhXrO2aZLsiUhGt6QnlGIZvepSqMWCGsp3KpYjjpccf5q5ub5mMpRbKOuapqKTOq2FZp10kpv7iTYiy4zlE8CQyzqU22qR+rsE+MEznr3n2/jkxMr4zvqCW4BsgZpnQOMXT2R4v1Y7B8++xG1SRfMAXMqx4UYwZpmWWu5DowUdfbF0rFjxxC87g1XbONQxGug7IV+zvOfeEZt27N8dQdzybO6POtw6uOM9DxG4O7vIwbE1bHSudIYFIEQnurEIuQG06Tla2+lqItnMQHQrivJ2pRVkzRjhp74p3Jo2b6ozFtdmIqKMpIr2yjd7MBsDKV0SXgj6X7VbQRzo=
  - secure: pFugJaYdvieD+OCaQyHbRXEBz6nJhZE15a7J7iFXG4kOnETl6Fmm4lT4f0OyIv/oZcnh7b3TOrCMUaOPP8niSAk4X5LLOvQ1UtSuc087OjYVeTF8VqQ0ozjz4K7bXCJNIa2MFMmYMt1hBJyOOncUvUmFweZBs9q2CwOzYy78bnzSUuOQ8frRmGdJcP6sE575Rj0UXku4on7KxO2g+HDyzV2yOzN80XOy1faeSL3clcwnCuZZ44lfGwh2QdMjNGH9adlKtS1AqpQ6CxK582gqhRy42wfTGbvTyr8KBnZ2itUzzhSzhGMtZMA3iiQ5ygevX6Y4kV6khcPP0aV7fQ5o5G2BPF1RFCncaRKMxOBjxf27supSE262Fv0MKdv1G43jaRqcKjN8PLWhiPdLZ7QtyaXXsJolWKMoAfxljdJLmQC9nSQkyO7oTm4TY6ycHD+jqLxmJC2hmYzjidG5ZUc06JCpNv6AHodcprRbbAhBoJ1OOUR3z14SZo+acj4wle3gLTGjnfWfsOuMrZDb+Luqt9LNGMSfjeEg0O/JSvdsUk/W4Ks7EW83jxQEEa7eMNTMZ4jJHgdErKqSBTrJ3TlYzYByYrdUibiGOFqMuYIvcxHv+IkT9H3woyUNM2S7D9HdzhF66BwCeasDS6E6gYbwh/nVx+qBsaibnBHqtT9ju2w=
  - secure: GBZk/XFV2Abe1yP4ESRgNCvJmpgMRqQpbRfLPD0XSDY4TVA25x4wMQzXj0r1xdU3CvsMIOCMuWGy68hTDLlU19AsEFqiuZMHAZSNb/svbYrRKhzHYP4TAeT7h163oeGxfVRjsjhjF+wrX4q/4mDsnD+Y3hsLdcZHPW5Ooq+CkEzeHQMpIYOT/LQTRSCIblY5CO0TWBYXN5u3nw5RJwFKJ4QM4pFmzzsufIDT6taM8i2z87OJVplMzMaOSHuod479LVyYVDRoUcW7kTqoedn9BPR6Qj8i7dYAA3ZDyAogjFsdc7vZ2p+HRlZ/e9Wq5zLlzT5+i+NUIk4Qf7TcV4Z1Pcxc1GvojKI64gNh1SAZzvCdT75597DI3xsPGDWLRwfIOQmYv3weGaL6EUrgrwcHNdXn2HfyzCouvMr8Rb1WxxG5ohY1F4NaI/qacPFO+YJpcEbSYzAXQkWygwlsOaJUdL/OjIqYkxdYoNB3rdvfgQ5s2F6XFpz3gpX3a0DOm72Y6aEcpvJLvUGtA+tWWTycEpQi1qZI28+KdyulvtEVLHUtNCTv0xMj9d2XCwRH6iL5DVPE1hgH6gtJZuTBl8lo1ZoVG9RlghD13Ih1A/xFEXW9Tad45hcHoLh6G/VuE2lETDQYcAU7uqpuk5AoHjhzFsTW2jcLraFkb/T2uXLtMjc=
  - secure: rPBIuNV+9oogaeR2unyiRWmeoObC9JYLNWXLyFHkj0RBJqRvjBY2sfaxRVpJgMV4ccIdC1KP7X2J/7ZFBSuwu5zbObzomSndt6JJLNfVworxUkVpthFx86NmWASyDPJP+/+CGOrgv63uSAyWDs9sGHHlHSmTjbPtL4hThBojOSlYodYeqECks1yQntQ3g21VSif+CkqA7sOgwXHcuSHYd9+Tajg3os5SRE05luCJAzMnhuqByOniV7RzwUujMCGwPcRRPFeuvbs2odaNzzTtyi/X4O2t77J+/jbrKIbV95YZM6SIZT9cVIpuIELOBmo4Z+ufvlnUx4SSdRNIuVANUkPFjMDUB+K6zuvmWc04mVgVY+wl4lXrHWKeCJ6+/4BpIb2rQOftr9BlpvXOzQGgsvSALWQPmyuszc6453njNTCqrOMJltNlNQO6sYHD1WW8dN/CEwklSqSWemokQj/RiZ86UgJCObldWl3QTJH3/mdwAtA+X6MsCUzfAEvkpC8lA2wDgmFgJg7wlxlHfbCYtftKvWRGIaLh5AaxjkLVzgTQsA6tI6VrHC6N1CPbawgDGMbxoZTrMzv6YPNLFWmCR+uP7laA2odqN+Dqjj/LNZ6NtLfx4CmrB0XgbFQkoNTSGVSGMy9q7oPIrmujgIoLuL/eml3lvBStdXycrgKveYw=
jobs:
  include:
  - stage: Unit tests
    script: make unit-test
  - stage: Build docker
    script: make npm-login docker-lint docker-build docker-tag docker-push
    if: branch = master
notifications:
  slack:
    secure: jNjoKgPrEuxoA29nI+9n3CQyimOikMeRhhgvXOf0gNzn80CA8TrSWdTVtD4aAsXeuSGVfPMXd1m+25gZjAdOwP+eK+9rF7y8y0qqhanBr2xYiJqA5u6chILJG9rJZwSFQC/07QIQM8a8d8+olXmFWSesZwkf+SBrDopRkCBX+fRZB4tRZL/Y2laJYuFMpHRBzFiyLRsS8UjeEg3l29VLqfLY6FP7G0uh54yW7gr/Pmbcv67HfNq9y81DacqhNWx/cGWI0zHhgcSBHHGYOA6vGxJFAVR0kDMz19VXZBpQRBWjPA0SvJVX1hknoQewVqR0MSk8aJbdxaYMLg24Vh5Mj8ayvCfb4uiluS5IKQfGXqCM9RyzR3m2QVTekpyf1zOMijTo12RrfuBFE3DpjOyfp4Kfm4XxK7qdsAhSmoCgBF5+Vy08+nMiWBY9qT1Pry2mgfUtFX2wAVqNIr+kXO9eYkduOb5Q/hwObXOmyb7YLZHm46x6bfvfMnfM3wktj3OCO3NBs5hjQ0ExH63jfBP4lsN1TxT1MrhscfYLWPS3NIilL0ttVbSj8OklAYqw7et1hFdyqxXUUH3/EoGBk7XMPVHz57iClNVDW+bbalBAHn7xkezTLNgPFsrYG1s+/CYKUBy4+xnlLL8ow0G+8S3dRD3tEXfVeX2xUrfg8OY8yXU=
  on_success: change
  on_failure: always
  on_pull_requests: false
